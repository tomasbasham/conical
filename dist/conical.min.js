var hyp=function(){"use strict";function a(b,c,d){if("undefined"===b||"string"!=typeof b)throw new Error("Experiment id is required.");return"string"!=typeof c&&(d=c,c=null),this instanceof a?(this.id=b,this.options=d||{},this.description=c,this.storagePrefix=this.storagePrefix+this.id,this.variants=[],this.handlers=[],this.allocateId(),this.options.variant&&this.hasVariant(this.options.variant)&&this.setVariant(this.options.variant),this):new a(b,c,d)}return a.prototype.min=0,a.prototype.max=1e5,a.prototype.uidKey="conical_uid",a.prototype.storagePrefix="experiment_",a.prototype.hasConverted=!1,a.prototype.hasExpired=function(){return new Date>this.options.expiry},a.prototype.addVariant=function(a,b,c){if("undefined"===a||"string"!=typeof a)throw new Error("Variant id is required.");return"object"!=typeof b&&(c=b,b={}),this.variants.push({id:a,run:c,options:b}),this},a.prototype.segment=function(){if(this.hasExpired())throw new Error("This experiment has expired.");if(this.variants.length<=0)throw new Error("This experiment has no variants.");return this.isParticipating()?this:(this.canParticipate()?this.participating():this.notParticipating(),this)},a.prototype.start=function(a){var b=this.getVariant();return this.variants.forEach(function(c){return function(d){d.id===b.variantId&&(d.run.call(a),c.trigger("start",b))}}(this)),this},a.prototype.allocateId=function(){var a=function(a){return function(b,c){var d=Math.floor(Math.random()*c+b);return a.setId(d)}}(this);return this.hasId()?this.getId():a(this.min,this.max)},a.prototype.hasId=function(){return!!this.getId()},a.prototype.setId=function(a){return localStorage.setItem(this.uidKey,a),a},a.prototype.getId=function(){if("undefined"==typeof Storage)throw new Error("Local storage is not supported in your browser.");return parseInt(localStorage.getItem(this.uidKey))},a.prototype.isParticipating=function(){return!!this.getVariant()},a.prototype.canParticipate=function(){return this.getId()<this.max*(this.options.sampleSize||1)},a.prototype.participating=function(){var a=function(a){return function(){var b=null,c=0,d=Math.random();for(b=0;b<a.variants.length;b++)if(c+=a.variants[b].options.weight||.5,c>=d)return a.variants[b];return{id:"no-chosen-variant"}}}(this);this.setVariant(a())},a.prototype.notParticipating=function(){this.setVariant({id:"not-participating"})},a.prototype.hasVariant=function(a){return this.variants.some(function(b){return b.id===a.id})},a.prototype.setVariant=function(a){if("undefined"==typeof Storage)throw new Error("Local storage is not supported in your browser.");localStorage.setItem(this.storagePrefix,JSON.stringify({experimentId:this.id,variantId:a.id}))},a.prototype.getVariant=function(){if("undefined"==typeof Storage)throw new Error("Local storage is not supported in your browser.");var a=localStorage.getItem(this.storagePrefix);return a?JSON.parse(a):null},a.prototype.clearVariant=function(){if("undefined"==typeof Storage)throw new Error("Local storage is not supported in your browser.");localStorage.removeItem(this.storagePrefix)},a.prototype.complete=function(){return this.hasConverted=!0,this.clearVariant(),this.trigger("complete",this.getVariant()),this},a.prototype.trigger=function(a){if("undefined"===a||"string"!=typeof a)throw new Error("Handler event name must be a string.");var b=null,c=this.handlers[a]||[],d=Array.prototype.slice.call(arguments,1);for(b=0;b<c.length;b++)c[b].call(this,d)},a.prototype.on=function(a,b){if("undefined"===a||"string"!=typeof a)throw new Error("Handler event name must be a string.");return this.handlers[a]=this.handlers[a]||[],this.handlers[a].push(b),this},a}();"function"==typeof define&&"undefined"!=typeof define.amd&&define("Conical",hyp);
//# sourceMappingURL=conical.min.js.map